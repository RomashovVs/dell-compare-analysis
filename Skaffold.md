# Skaffold для разработки под Kubernetes

Skaffold решает задачу автоматизации цикла CI/CD (на стадиях build, push, deploy), предлагая разработчику оперативную обратную связь, 
т.е. возможность быстро получать результат очередных изменений кода — в виде обновлённого приложения, работающего в кластере Kubernetes.

>Исходный код Skaffold написан на языке Go, распространяется на условиях свободной лицензии Apache License 2.0 [GitHub](https://github.com/GoogleContainerTools/skaffold).

## Основные функции
* Skaffold предлагает инструментарий для создания CI/CD-пайплайнов.
* Позволяет в фоновом режиме следить за изменениями в исходном коде и запускать автоматизированный процесс сборки кода в образы контейнеров, публикации этих образов в Docker Registry и их деплоя в кластер Kubernetes.
* Синхронизирует файлы в репозитории с рабочим каталогом в контейнере.
* Автоматически тестирует с помощью container-structure-test.
* Пробрасывает порты.
* Читает логи приложения, запущенного в контейнере.
* Помогает в отладке приложений, написанных на Java, Node.js, Python, Go.

## Особенности
* __У самого Skaffold нет компонентов на стороне кластера__. То есть дополнительно настраивать Kubernetes для использования этой утилиты не требуется.
* __Разные пайплайны для вашего приложения__. Нужно выкатывать код в локальный Minikube, пока ведете разработку, а после — на stage или production? 
Для этого предусмотрены [профили](https://skaffold.dev/docs/environment/profiles/) и пользовательские конфигурации, 
переменные окружения и флаги, что позволяют описывать разные пайплайны для одного приложения.
* __CLI__. Только консольная утилита и конфигурации в YAML. 
* __Модульность__. Skaffold не является самостоятельным комбайном, а стремится использовать отдельные модули или уже существующие решения для конкретных задач.

Иллюстрация последнего:
* На стадии сборки можно использовать:
  * *docker build* локально, в кластере с помощью *kaniko* или в *Google Cloud Build*;
  * *Bazel* локально;
  * *Jib Maven* и *Jib Gradle* локально или в *Google Cloud Build*;
  * кастомные build-скрипты, запускаемые локально. Если вам нужно запускать другое (более гибкое/привычное/…) 
  решение для сборки, оно описывается в скрипте, чтобы Skaffold запускал именно его 
  (пример из документации). Это позволяет использовать вообще любой сборщик, который можно вызвать с помощью скрипта;
* На стадии тестирования поддерживается уже упомянутый container-structure-test;
* Для деплоя предусмотрены:
  * Kubectl;
  * Helm;
  * kustomize

Благодаря этому Skaffold можно назвать своеобразным фреймворком для построения CI/CD. 

## Работа в общих чертах
1. Утилита следит за изменениями в директории с исходным кодом. Если в файлы вносятся модификации, они синхронизируются с pod’ом приложения в кластере Kubernetes. 
   Если это возможно — без повторной сборки образа. В ином случае — собирается новый образ.
2. Собранный образ проверяется с помощью container-structure-test, тегируется и отправляется в Docker Registry.
3. После этого образ деплоится — разворачивается в кластере Kubernetes.
4. Если запуск был инициализирован с помощью команды skaffold dev, то мы начинаем получать логи от приложения, 
   а Skaffold ожидает изменений, чтобы повторить все действия заново.
   
   ___
   >Источник - https://habr.com/ru/company/flant/blog/474692/
